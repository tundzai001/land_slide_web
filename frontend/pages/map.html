<!--frontend/pages/map.html-->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map - Landslide Monitor</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/theme-variables.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/map.css">
</head>
<body>

    <!-- TOP NAVBAR -->
    <nav class="top-navbar">
        <div class="d-flex align-items-center gap-3">
            <a href="/" class="brand-text">
                <i class="bi bi-activity"></i>
                <span>Landslide Monitor</span>
            </a>
            
            <a href="/pages/admin.html" id="admin-nav-btn" class="btn btn-sm btn-outline-primary" style="display: none;">
                <i class="bi bi-gear-fill me-1"></i> Qu·∫£n l√Ω
            </a>
        </div>
        
        <div class="d-flex align-items-center gap-3">
            <button id="theme-toggle-btn" class="btn btn-link text-white">
                <i class="bi bi-moon-stars-fill"></i>
            </button>
            
            <!-- Auth Button -->
            <button id="auth-btn" class="btn btn-primary btn-sm">
                <i class="bi bi-person-circle me-1"></i> Account
            </button>
        </div>
    </nav>

    <button class="toggle-list-btn" id="toggle-list-btn">
        <i class="bi bi-list"></i>
    </button>

    <!-- LEFT SIDEBAR (Station List) -->
    <div class="station-list-sidebar" id="station-list-sidebar">
        <div class="sidebar-header">
            <h6><i class="bi bi-hdd-network me-2"></i>Danh s√°ch Tr·∫°m</h6>
        </div>
        
        <button class="sidebar-close-tab" id="sidebar-close-tab">
            <i class="bi bi-chevron-left"></i>
        </button>
        
        <div class="sidebar-search">
            <input type="text" class="form-control form-control-sm" placeholder="T√¨m ki·∫øm tr·∫°m..." id="search-station">
        </div>
        
        <div class="station-list-content" id="station-list-container">
            <!-- Station list here -->
        </div>
    </div>

    <!-- MAP -->
    <div id="map"></div>

    <!-- RIGHT DETAIL SIDEBAR -->
    <div class="detail-sidebar" id="detail-sidebar">
        <div class="sidebar-header">
            <div>
                <h5 id="st-name">Station Name</h5>
                <small class="text-muted" id="st-code">CODE</small>
            </div>
            <button class="btn btn-sm btn-outline-danger" id="close-btn">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Risk Badge -->
            <div id="st-risk" class="risk-badge">...</div>

            <!--REALTIME VIEW -->
            <div id="realtime-view">
                <!-- COMPACT SENSOR DATA -->
                <div class="sensor-compact">
                    <!-- GNSS -->
                    <div class="sensor-item">
                        <div class="sensor-label"><i class="bi bi-geo-alt-fill me-1"></i>GNSS Velocity</div>
                        <div class="sensor-value-large" id="val-gnss-vel">--<span class="sensor-unit">mm/s</span></div>
                    </div>

                    <!-- Rain Intensity -->
                    <div class="sensor-item">
                        <div class="sensor-label"><i class="bi bi-cloud-rain-fill me-1"></i>Rain Intensity</div>
                        <div class="sensor-value-large" id="val-rain">--<span class="sensor-unit">mm/h</span></div>
                    </div>

                    <!-- Water Level -->
                    <div class="sensor-item">
                        <div class="sensor-label"><i class="bi bi-water me-1"></i>Water Level</div>
                        <div class="sensor-value-large" id="val-water">--<span class="sensor-unit">m</span></div>
                    </div>

                    <!-- IMU (3 axes) -->
                    <div class="sensor-item">
                        <div class="sensor-label"><i class="bi bi-compass-fill me-1"></i>IMU (Roll/Pitch/Yaw)</div>
                        <div class="imu-axes">
                            <div class="axis-value">
                                <div class="axis-label">Roll</div>
                                <div class="axis-num" id="val-imu-roll">--¬∞</div>
                            </div>
                            <div class="axis-value">
                                <div class="axis-label">Pitch</div>
                                <div class="axis-num" id="val-imu-pitch">--¬∞</div>
                            </div>
                            <div class="axis-value">
                                <div class="axis-label">Yaw</div>
                                <div class="axis-num" id="val-imu-yaw">--¬∞</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--ACTION BUTTONS -->
                <div class="action-buttons">
                    <button class="btn-action" id="btn-show-charts">
                        <i class="bi bi-graph-up me-2"></i>Xem bi·ªÉu ƒë·ªì
                    </button>
                    <button class="btn-action secondary" id="btn-long-term">
                        <i class="bi bi-calendar-range me-2"></i>Ph√¢n t√≠ch d√†i h·∫°n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--CENTER CHARTS PANEL (T√°ch bi·ªát ·ªü gi·ªØa m√†n h√¨nh) -->
    <div class="charts-panel" id="charts-panel">
        <div class="charts-panel-header">
            <h5><i class="bi bi-graph-up me-2"></i>Bi·ªÉu ƒë·ªì 24h</h5>
            <button class="btn btn-sm btn-outline-light" id="close-charts-btn">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>
        
        <div class="charts-panel-content">
            <div class="chart-box">
                <div class="chart-title">üìà GNSS Displacement (24h)</div>
                <div style="height: 250px;">
                    <canvas id="chart-gnss"></canvas>
                </div>
            </div>

            <div class="chart-box">
                <div class="chart-title">üåßÔ∏è Rain Intensity (24h)</div>
                <div style="height: 250px;">
                    <canvas id="chart-rain"></canvas>
                </div>
            </div>

            <div class="chart-box">
                <div class="chart-title">üåä Water Level (24h)</div>
                <div style="height: 250px;">
                    <canvas id="chart-water"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!--LONG-TERM ANALYSIS FULLSCREEN OVERLAY -->
    <div class="longterm-overlay" id="longterm-overlay">
        <div class="longterm-container">
            <div class="longterm-header">
                <div>
                    <h4><i class="bi bi-calendar-range me-2"></i>Ph√¢n t√≠ch d√†i h·∫°n</h4>
                    <small class="text-muted" id="longterm-station-name">Station Name</small>
                </div>
                <button class="btn btn-lg btn-outline-light" id="close-longterm-btn">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <div class="longterm-content-wrapper">
                <!-- Loading State -->
                <div id="longterm-loading" style="display: none;">
                    <div class="text-center my-5">
                        <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;"></div>
                        <p class="fs-5">ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</p>
                    </div>
                </div>

                <!-- Error State -->
                <div id="longterm-error" style="display: none;">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Kh√¥ng ƒë·ªß d·ªØ li·ªáu</strong>
                        <p id="error-message" class="mb-0 mt-2">C·∫ßn √≠t nh·∫•t 7 ng√†y d·ªØ li·ªáu GNSS ƒë·ªÉ ph√¢n t√≠ch.</p>
                    </div>
                </div>

                <!-- Content State -->
                <div id="longterm-content" style="display: none;">
                    <!-- Warning Banner -->
                    <div id="longterm-warning" class="alert alert-warning" style="display: none;">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong id="warning-text">C·∫£nh b√°o!</strong>
                    </div>

                    <!-- Main Metrics -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3 col-6">
                            <div class="longterm-metric-card">
                                <div class="text-muted small">V·∫≠n t·ªëc trung b√¨nh</div>
                                <div class="fs-4 fw-bold text-primary mt-1" id="lt-velocity">-- mm/nƒÉm</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="longterm-metric-card">
                                <div class="text-muted small">Ph√¢n lo·∫°i</div>
                                <div class="fs-5 fw-bold mt-1" id="lt-classification">--</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="longterm-metric-card">
                                <div class="text-muted small">T·ªïng chuy·ªÉn d·ªãch</div>
                                <div class="fs-5 fw-bold text-danger mt-1" id="lt-total-disp">-- mm</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="longterm-metric-card">
                                <div class="text-muted small">Th·ªùi gian theo d√µi</div>
                                <div class="fs-5 fw-bold mt-1" id="lt-duration">-- ng√†y</div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <!-- Trend Indicator -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title">Xu h∆∞·ªõng</h6>
                                    <div id="trend-indicator" class="d-flex align-items-center gap-2">
                                        <span id="trend-icon" class="fs-3">‚ùì</span>
                                        <span id="trend-value" class="fs-5 fw-bold">Kh√¥ng x√°c ƒë·ªãnh</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Classification Scale -->
                        <div class="col-md-6">
                            <div class="chart-box h-100">
                                <div class="chart-title">üìä B·∫£ng ph√¢n lo·∫°i Cruden & Varnes</div>
                                <div id="classification-scale"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Long-term Chart -->
                    <div class="chart-box mt-3">
                        <div class="chart-title">Bi·ªÉu ƒë·ªì chuy·ªÉn d·ªãch t√≠ch l≈©y</div>
                        <div style="height: 400px;">
                            <canvas id="chart-longterm"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/theme-manager.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/map-main.js"></script>

</body>
</html>